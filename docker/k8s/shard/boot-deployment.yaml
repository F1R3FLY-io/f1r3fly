apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kompose.cmd: kompose -f docker/shard.yml convert -o ./docker/k8s/shard/
    kompose.version: 1.32.0 (HEAD)
  labels:
    io.kompose.service: boot
  name: boot
  namespace: f1r3fly
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: boot
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        kompose.cmd: kompose -f docker/shard.yml convert -o ./docker/k8s/shard/
        kompose.version: 1.32.0 (HEAD)
      labels:
        io.kompose.network/docker-f1r3fly: "true"
        io.kompose.service: boot
    spec:
      #imagePullSecrets:
        #- name: ghcr-login-secret
      containers:
        - args:
            - run
#            - --host=$(MY_POD_IP)
            - --allow-private-addresses
            - --validator-private-key=5f668a7ee96d944a4494cc947e4005e172d7ab3461ee5538f1f2a45a835e9657
            - -Dlogback.configurationFile=/var/lib/rnode/logback.xml
          image: ghcr.io/f1r3fly-io/rnode:latest
          #image: rchain/rnode:latest
          name: boot
#          env:
#            - name: MY_POD_IP
#              valueFrom:
#                fieldRef:
#                  fieldPath: status.podIP
          imagePullPolicy: Never
          ports:
            - containerPort: 40400
              hostPort: 40400
              protocol: TCP
            - containerPort: 40401
              hostPort: 40401
              protocol: TCP
            - containerPort: 40402
              hostPort: 40402
              protocol: TCP
            - containerPort: 40403
              hostPort: 40403
              protocol: TCP
            - containerPort: 40404
              hostPort: 40404
              protocol: TCP
          volumeMounts:
            - mountPath: /var/lib/rnode
              name: boot-claim0
            - name: boot-configmap
              mountPath: /var/lib/rnode/rnode.conf
              subPath: bootstrap.conf
            - name: boot-configmap
              mountPath: /var/lib/rnode/genesis/wallets.txt
              subPath: wallets.txt
            - name: boot-configmap
              mountPath: /var/lib/rnode/genesis/bonds.txt
              subPath: bonds.txt
            - name: boot-configmap
              mountPath: /var/lib/rnode/logback.xml
              subPath: logback.xml
      restartPolicy: Always
      volumes:
        - name: boot-claim0
          persistentVolumeClaim:
            claimName: boot-claim0
        - name: boot-configmap
          configMap:
            name: boot-configmap
